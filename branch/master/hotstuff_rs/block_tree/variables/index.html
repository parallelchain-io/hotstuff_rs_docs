<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Byte-prefixes that specify where each Block Tree variable is stored in the user-provided key-value store."><title>hotstuff_rs::block_tree::variables - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="hotstuff_rs" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0 (90b35a623 2024-11-26)" data-channel="1.83.0" data-search-js="search-f0d225181b97f9a4.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../../../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/parallelchain-io/hotstuff_rs/refs/heads/final_touches/readme_assets/HotStuff-rs%20logo.png"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../../hotstuff_rs/index.html"><img src="https://raw.githubusercontent.com/parallelchain-io/hotstuff_rs/refs/heads/final_touches/readme_assets/HotStuff-rs%20logo.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../../hotstuff_rs/index.html"><img src="https://raw.githubusercontent.com/parallelchain-io/hotstuff_rs/refs/heads/final_touches/readme_assets/HotStuff-rs%20logo.png" alt="logo"></a><h2><a href="../../../hotstuff_rs/index.html">hotstuff_<wbr>rs</a><span class="version">0.4.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module variables</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#list-of-state-variables" title="List of State Variables">List of State Variables</a><ul><li><a href="#blocks" title="Blocks">Blocks</a></li><li><a href="#app-state" title="App State">App State</a></li><li><a href="#validator-set" title="Validator Set">Validator Set</a></li><li><a href="#safety" title="Safety">Safety</a></li></ul></li><li><a href="#persistence-of-state-variables" title="Persistence of state variables">Persistence of state variables</a><ul><li><a href="#single-values" title="Single values">Single values</a></li><li><a href="#mappings" title="Mappings">Mappings</a></li><li><a href="#blocks-1" title="Blocks">Blocks</a></li></ul></li></ul><h3><a href="#constants">Module Items</a></h3><ul class="block"><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In hotstuff_<wbr>rs::<wbr>block_<wbr>tree</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">hotstuff_rs</a>::<wbr><a href="../index.html">block_tree</a></span><h1>Module <span>variables</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/hotstuff_rs/block_tree/variables.rs.html#6-169">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Byte-prefixes that specify where each Block Tree variable is stored in the user-provided key-value
store.</p>
<h2 id="list-of-state-variables"><a class="doc-anchor" href="#list-of-state-variables">§</a>List of State Variables</h2>
<p>HotStuff-rs structures its state into 17 separate conceptual “variables” that are stored in tuples
that sit at <a href="super::paths">specific key paths</a> in the library user’s chosen
KV store. These 17 variables are listed below, grouped into 4 categories for ease of understanding:</p>
<h3 id="blocks"><a class="doc-anchor" href="#blocks">§</a>Blocks</h3><div><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Blocks</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a> -&gt; <a href="../../types/block/struct.Block.html" title="struct hotstuff_rs::types::block::Block"><code>Block</code></a></td><td>Mapping between a block’s hash and the block itself. This mapping contains all blocks that have been inserted into the block tree, excluding blocks that have been pruned.</td></tr>
<tr><td>Block at Height</td><td><a href="../../types/data_types/struct.BlockHeight.html" title="struct hotstuff_rs::types::data_types::BlockHeight"><code>BlockHeight</code></a> -&gt; <a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a></td><td>Mapping between a block’s height and its block hash. This mapping only contains blocks that are committed, because if a block hasn’t been committed, there may be multiple blocks at the same height.</td></tr>
<tr><td>Block to Children</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a> -&gt; <a href="../../types/data_types/struct.ChildrenList.html" title="struct hotstuff_rs::types::data_types::ChildrenList"><code>ChildrenList</code></a></td><td>Mapping between a block’s hash and the list of children it has in the block tree. A block may have multiple children if they have not been committed.</td></tr>
</tbody></table>
</div><h3 id="app-state"><a class="doc-anchor" href="#app-state">§</a>App State</h3><div><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Committed App State</td><td><a href="https://doc.rust-lang.org/1.83.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec"><code>Vec&lt;u8&gt;</code></a> -&gt; <a href="https://doc.rust-lang.org/1.83.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec"><code>Vec&lt;u8&gt;</code></a></td><td>All key value pairs in the current committed app state. Produced by applying all app state updates in sequence from the genesis block up to the highest committed block.</td></tr>
<tr><td>Pending App State Updates</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a> -&gt; <a href="../../types/update_sets/type.AppStateUpdates.html" title="type hotstuff_rs::types::update_sets::AppStateUpdates"><code>AppStateUpdates</code></a></td><td>Mapping between a block’s hash and its app state updates. This is empty for an existing block if at least one of the following two cases is true: <ol><li>The block does not update the app state.</li> <li>The block has been committed.</li></ol></td></tr>
</tbody></table>
</div><h3 id="validator-set"><a class="doc-anchor" href="#validator-set">§</a>Validator Set</h3><div><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Committed Validator Set</td><td><a href="../../types/validator_set/struct.ValidatorSet.html" title="struct hotstuff_rs::types::validator_set::ValidatorSet"><code>ValidatorSet</code></a></td><td>The current committed validator set. Produced by applying all validator set updates in sequence from the genesis block up to the highest committed block.</td></tr>
<tr><td>Previous Validator Set</td><td><a href="../../types/validator_set/struct.ValidatorSet.html" title="struct hotstuff_rs::types::validator_set::ValidatorSet"><code>ValidatorSet</code></a></td><td>The committed validator set before the latest validator set update was committed. <br/><br/>Until a validator set update is considered “decided” (as indicated by the next variable), the previous validator set remains “active”. That is, leaders will continue broadcasting nudges for the previous validator set and replicas will continue voting for such nudges.</td></tr>
<tr><td>Validator Set Update Decided</td><td><a href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html" title="primitive bool"><code>bool</code></a></td><td>A flag that indicates the most recently committed validator set update has been decided.</td></tr>
<tr><td>Validator Set Update Block Height</td><td><a href="../../types/data_types/struct.BlockHeight.html" title="struct hotstuff_rs::types::data_types::BlockHeight"><code>BlockHeight</code></a></td><td>The height of the block that caused the most recent committed (but perhaps not decided) validator set update.</td></tr>
<tr><td>Validator Set Updates Status</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a> -&gt; <a href="../../types/validator_set/enum.ValidatorSetUpdatesStatus.html" title="enum hotstuff_rs::types::validator_set::ValidatorSetUpdatesStatus"><code>ValidatorSetUpdatesStatus</code></a></td><td>Mapping between a block’s hash and its validator set updates. <br/><br/>Unlike <a href="#app-state">pending app state updates</a>, this is an enum, and distinguishes between the case where the block does not update the validator set and the case where the block updates the validator set but has been committed.</td></tr>
</tbody></table>
</div><h3 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h3><div><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Locked Phase Certificate</td><td><a href="../../hotstuff/types/struct.PhaseCertificate.html" title="struct hotstuff_rs::hotstuff::types::PhaseCertificate"><code>PhaseCertificate</code></a></td><td>The currently locked PC. <a href="invariants#locking">Read more</a></td></tr>
<tr><td>Highest View Phase-Voted</td><td><a href="../../types/data_types/struct.ViewNumber.html" title="struct hotstuff_rs::types::data_types::ViewNumber"><code>ViewNumber</code></a></td><td>The highest view that this validator has phase-voted in.</td></tr>
<tr><td>Highest View Entered</td><td><a href="../../types/data_types/struct.ViewNumber.html" title="struct hotstuff_rs::types::data_types::ViewNumber"><code>ViewNumber</code></a></td><td>The highest view that this validator has entered.</td></tr>
<tr><td>Highest Phase Certificate</td><td><a href="../../hotstuff/types/struct.PhaseCertificate.html" title="struct hotstuff_rs::hotstuff::types::PhaseCertificate"><code>PhaseCertificate</code></a></td><td>Among the phase certificates this validator has seen and verified, the one with the highest view number.</td></tr>
<tr><td>Highest Timeout Certificate</td><td><a href="../../pacemaker/types/struct.TimeoutCertificate.html" title="struct hotstuff_rs::pacemaker::types::TimeoutCertificate"><code>TimeoutCertificate</code></a></td><td>Among the timeout certificates this validator has seen and verified, the one with the highest view number.</td></tr>
<tr><td>Highest Committed Block</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a></td><td>The hash of the committed block that has the highest height.</td></tr>
<tr><td>Newest Block</td><td><a href="../../types/data_types/struct.CryptoHash.html" title="struct hotstuff_rs::types::data_types::CryptoHash"><code>CryptoHash</code></a></td><td>The hash of the most recent block to be inserted into the block tree.</td></tr>
</tbody></table>
</div><h2 id="persistence-of-state-variables"><a class="doc-anchor" href="#persistence-of-state-variables">§</a>Persistence of state variables</h2>
<p>This section specifies how each state variable is persisted into user-provided
<a href="../pluggables/index.html" title="mod hotstuff_rs::block_tree::pluggables">key-value stores (<code>KVStore</code>)</a>. Each variable is stored as <strong>Borsh-serialized
values</strong> in one or more <strong>keys</strong> in the key-value store. These keys are formed by combining the
<a href="#constants">constants</a> defined in this module in specific ways, as described in the following three
subsections:</p>
<h3 id="single-values"><a class="doc-anchor" href="#single-values">§</a>Single values</h3>
<p>“Single values” (e.g., committed validator set, locked PC) are stored in one-byte, constant keys
defined in constants sharing the variable’s name.</p>
<p>For example, the locked PC variable is set by serializing a <code>PhaseCertificate</code> and setting it at
the <a href="constant.LOCKED_PC.html" title="constant hotstuff_rs::block_tree::variables::LOCKED_PC"><code>LOCKED_PC</code></a> key.</p>
<h3 id="mappings"><a class="doc-anchor" href="#mappings">§</a>Mappings</h3>
<p>Mappings of the form “<code>A</code> -&gt; <code>B</code>” (e.g., blocks) are stored in multiple keys, each key being the
concatenation of a specific constant one-byte prefix sharing the variable’s name, and then the
serialization of an instance of the <code>A</code> type.</p>
<p>For example, to store a key-value pair into the app state directly using
<a href="../pluggables/trait.WriteBatch.html" title="trait hotstuff_rs::block_tree::pluggables::WriteBatch"><code>WriteBatch</code></a>, one would do:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">const </span>as_key: <span class="kw-2">&amp;</span>str = <span class="string">"hello"</span>;
<span class="kw">const </span>as_value: <span class="kw-2">&amp;</span>str = <span class="string">"world"</span>;
<span class="kw">let </span>key = concat(<span class="kw-2">&amp;</span>COMMITTED_APP_STATE, <span class="kw-2">&amp;</span>as_key.try_to_vec().unwrap());
write_batch.set(<span class="kw-2">&amp;</span>key, <span class="kw-2">&amp;</span>as_value.try_to_vec().unwrap());</code></pre></div>
<p>Note: if you ever need to set variables in the block tree, you shouldn’t need to use <code>WriteBatch</code>
directly. Instead, use <a href="super::write_batch::BlockTreeWriteBatch"><code>BlockTreeWriteBatch</code></a>, which
abstracts the forming of keys from you and then internally calls <code>WriteBatch::set</code>.</p>
<h3 id="blocks-1"><a class="doc-anchor" href="#blocks-1">§</a>Blocks</h3>
<p>Blocks are neither single values nor mappings and are stored in a special way. Each block can be
thought of as being stored in <strong>5</strong> separate state variables, with each state variable corresponding
to one of the block’s 5 fields.</p>
<p>The following two subsections describe how these fields are stored. The first 4 of these fields (the
non-<code>data</code> fields) are stored in a straightforward manner and are discussed in the first subsection.
Storage of the remaining field, <code>data</code>, is more complicated and so is discussed separately in the
second subsection. <strong>Note</strong> that because blocks appear in the block tree only as part of the
“blocks” state variable, which is a mapping from <code>CryptoHash</code> to <code>Block</code>, all of the following
discussions will assume this context.</p>
<h4 id="non-data-fields"><a class="doc-anchor" href="#non-data-fields">§</a>Non-<code>data</code> fields</h4>
<p>The non-<code>data</code> fields of a block (<code>height</code>, <code>hash</code>, <code>justify</code>, and <code>data_hash</code>) are stored like
<strong>separate</strong> single values at keys formed by concatenating three bytestrings in sequence:</p>
<ol>
<li>The <a href="constant.BLOCKS.html" title="constant hotstuff_rs::block_tree::variables::BLOCKS"><code>BLOCKS</code></a> constant.</li>
<li><code>block.hash</code>.</li>
<li>A constant byte sharing the same name as the field. (e.g., for a block’s height, this byte is
<code>BLOCK_HEIGHT</code>.</li>
</ol>
<h4 id="data-field"><a class="doc-anchor" href="#data-field">§</a>Data field</h4>
<p>A block’s <code>data</code> is stored in two sets of keys, or more specifically, one single key and one
separate set of keys:</p>
<ol>
<li>The single key (<code>BLOCKS</code> + <code>block.hash</code> + <a href="constant.BLOCK_DATA_LEN.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_DATA_LEN"><code>BLOCK_DATA_LEN</code></a>) stores <code>data.len() as u32</code>.</li>
<li>The set of keys (<code>BLOCKS</code> + <code>block.hash</code> + <a href="constant.BLOCK_DATA.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_DATA"><code>BLOCK_DATA</code></a> + <code>block.data[i]</code>) stores each datum
in the data vector in sequence.</li>
</ol>
<p>If <code>block.data</code> is empty, then none of the keys in the second set will be set. However, the data
length key will be set to <code>0 as u32</code>. Generally speaking, if a block exists in the block tree, its
data length key will always be set.</p>
</div></details><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.BLOCKS.html" title="constant hotstuff_rs::block_tree::variables::BLOCKS">BLOCKS</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_AT_HEIGHT.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_AT_HEIGHT">BLOCK_<wbr>AT_<wbr>HEIGHT</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_DATA.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_DATA">BLOCK_<wbr>DATA</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_DATA_HASH.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_DATA_HASH">BLOCK_<wbr>DATA_<wbr>HASH</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_DATA_LEN.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_DATA_LEN">BLOCK_<wbr>DATA_<wbr>LEN</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_HEIGHT.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_HEIGHT">BLOCK_<wbr>HEIGHT</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_JUSTIFY.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_JUSTIFY">BLOCK_<wbr>JUSTIFY</a></div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_TO_CHILDREN.html" title="constant hotstuff_rs::block_tree::variables::BLOCK_TO_CHILDREN">BLOCK_<wbr>TO_<wbr>CHILDREN</a></div></li><li><div class="item-name"><a class="constant" href="constant.COMMITTED_APP_STATE.html" title="constant hotstuff_rs::block_tree::variables::COMMITTED_APP_STATE">COMMITTED_<wbr>APP_<wbr>STATE</a></div></li><li><div class="item-name"><a class="constant" href="constant.COMMITTED_VALIDATOR_SET.html" title="constant hotstuff_rs::block_tree::variables::COMMITTED_VALIDATOR_SET">COMMITTED_<wbr>VALIDATOR_<wbr>SET</a></div></li><li><div class="item-name"><a class="constant" href="constant.HIGHEST_COMMITTED_BLOCK.html" title="constant hotstuff_rs::block_tree::variables::HIGHEST_COMMITTED_BLOCK">HIGHEST_<wbr>COMMITTED_<wbr>BLOCK</a></div></li><li><div class="item-name"><a class="constant" href="constant.HIGHEST_PC.html" title="constant hotstuff_rs::block_tree::variables::HIGHEST_PC">HIGHEST_<wbr>PC</a></div></li><li><div class="item-name"><a class="constant" href="constant.HIGHEST_TC.html" title="constant hotstuff_rs::block_tree::variables::HIGHEST_TC">HIGHEST_<wbr>TC</a></div></li><li><div class="item-name"><a class="constant" href="constant.HIGHEST_VIEW_ENTERED.html" title="constant hotstuff_rs::block_tree::variables::HIGHEST_VIEW_ENTERED">HIGHEST_<wbr>VIEW_<wbr>ENTERED</a></div></li><li><div class="item-name"><a class="constant" href="constant.HIGHEST_VIEW_PHASE_VOTED.html" title="constant hotstuff_rs::block_tree::variables::HIGHEST_VIEW_PHASE_VOTED">HIGHEST_<wbr>VIEW_<wbr>PHASE_<wbr>VOTED</a></div></li><li><div class="item-name"><a class="constant" href="constant.LOCKED_PC.html" title="constant hotstuff_rs::block_tree::variables::LOCKED_PC">LOCKED_<wbr>PC</a></div></li><li><div class="item-name"><a class="constant" href="constant.NEWEST_BLOCK.html" title="constant hotstuff_rs::block_tree::variables::NEWEST_BLOCK">NEWEST_<wbr>BLOCK</a></div></li><li><div class="item-name"><a class="constant" href="constant.PENDING_APP_STATE_UPDATES.html" title="constant hotstuff_rs::block_tree::variables::PENDING_APP_STATE_UPDATES">PENDING_<wbr>APP_<wbr>STATE_<wbr>UPDATES</a></div></li><li><div class="item-name"><a class="constant" href="constant.PREVIOUS_VALIDATOR_SET.html" title="constant hotstuff_rs::block_tree::variables::PREVIOUS_VALIDATOR_SET">PREVIOUS_<wbr>VALIDATOR_<wbr>SET</a></div></li><li><div class="item-name"><a class="constant" href="constant.VALIDATOR_SET_UPDATES_STATUS.html" title="constant hotstuff_rs::block_tree::variables::VALIDATOR_SET_UPDATES_STATUS">VALIDATOR_<wbr>SET_<wbr>UPDATES_<wbr>STATUS</a></div></li><li><div class="item-name"><a class="constant" href="constant.VALIDATOR_SET_UPDATE_BLOCK_HEIGHT.html" title="constant hotstuff_rs::block_tree::variables::VALIDATOR_SET_UPDATE_BLOCK_HEIGHT">VALIDATOR_<wbr>SET_<wbr>UPDATE_<wbr>BLOCK_<wbr>HEIGHT</a></div></li><li><div class="item-name"><a class="constant" href="constant.VALIDATOR_SET_UPDATE_DECIDED.html" title="constant hotstuff_rs::block_tree::variables::VALIDATOR_SET_UPDATE_DECIDED">VALIDATOR_<wbr>SET_<wbr>UPDATE_<wbr>DECIDED</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.concat.html" title="fn hotstuff_rs::block_tree::variables::concat">concat</a></div><div class="desc docblock-short">Concatenate two byteslices into one vector.</div></li></ul></section></div></main></body></html>